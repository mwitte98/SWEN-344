<!doctype html>
<html ng-app='swenApp'>
<head>

    <% include header %>
	
	<title>Calendar</title>

	<!-- Calendar Scripts -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.min.js"></script>
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.4.0/fullcalendar.min.css">
    <script src="js/combodate.js"></script>

	<script>
	
		$(document).ready(function() {
            var calendar = $('#calendar');
		    calendar.fullCalendar({
			    dayClick: function(date, jsEvent, view) {
                    var defaultDate = (date.month()+1) + "-" + date.date() + "-" + date.year() + " 12:00 am";
                    $('#addEventStart').combodate('setValue', defaultDate);
                    $('#addEventEnd').combodate('setValue', defaultDate);
                    $("#addEventModal").modal('show');
				},
                eventRender: function(event, element) {
                    $(element).addClass("clickableEvent");
                    $(element).click(function() {
                        document.getElementById("eventDetailsTitle").innerHTML = event.title;
                        document.getElementById("eventDetailsStart").innerHTML = event.start.format('MMMM Do YYYY, h:mm a');
                        document.getElementById("eventDetailsEnd").innerHTML = event.end.format('MMMM Do YYYY, h:mm a');
                        document.getElementById("eventDetailsLocation").innerHTML = event.location;
                        document.getElementById("eventDetailsDesc").innerHTML = event.description;
                        $("#eventDetailsModal").modal('show');
                    });
                }
			});
            
            calendar.fullCalendar('renderEvent', {
                title: 'Thanksgiving',
                start: '2015-11-26',
                end: '2015-11-27',
                location: 'Home',
                description: 'Lots of food!'
            });
            
            $('#addEventSubmit').click(function() {
                var title = document.getElementById("addEventTitle").value;
                var start = document.getElementById("addEventStart").value;
                var end = document.getElementById("addEventEnd").value;
                var location = document.getElementById("addEventLocation").value;
                var desc = document.getElementById("addEventDesc").value;
                var startDate = moment(start, 'MM-DD-YYYY h:mm a');
                var endDate = moment(end, 'MM-DD-YYYY h:mm a');
                
                if ($.trim(title).length <= 0) {
                    alert("The title must be filled in.");
                }
                else if (endDate.isBefore(startDate) || endDate.isSame(startDate)) {
                    alert("The end date must be after the start date.");
                }
                else {
                    calendar.fullCalendar('renderEvent', {
                        title: title,
                        start: startDate,
                        end: endDate,
                        location: location,
                        description: desc
                    });
                    
                    document.getElementById("addEventTitle").value = '';
                    $('#addEventStart').combodate('setValue', null);
                    $('#addEventEnd').combodate('setValue', null);
                    document.getElementById("addEventLocation").value = '';
                    document.getElementById("addEventDesc").value = '';
                    $("#addEventModal").modal('hide');
                }
            });
            
            $('#eventDetailsSubmit').click(function() {
                var title = document.getElementById("eventDetailsTitle").innerText;
                var start = document.getElementById("eventDetailsStart").innerText;
                var end = document.getElementById("eventDetailsEnd").innerText;
                var location = document.getElementById("eventDetailsLocation").innerText;
                var desc = document.getElementById("eventDetailsDesc").innerText;
                
                calendar.fullCalendar('removeEvents', function(event) {
                    if (event.title == title && 
                        event.start.format('MMMM Do YYYY, h:mm a') == start && 
                        event.end.format('MMMM Do YYYY, h:mm a') == end && 
                        event.location == location && 
                        event.description == desc) {
                        return true;
                    }
                });
                
                $("#eventDetailsModal").modal('hide');
            });
            
            $(function(){
                $('#addEventStart').combodate({
                    minYear: 2015,
                    maxYear: 2020,
                    minuteStep: 1
                });
            });
            
            $(function(){
                $('#addEventEnd').combodate({
                    minYear: 2015,
                    maxYear: 2020,
                    minuteStep: 1
                });
            });
		});
	
	</script>

</head>
<body ng-controller="mainCtrl">
    <% include navbar %>

    <main>
        <div class="container">
            <div class="modal fade" id="addEventModal" tabindex="-1" role="dialog" aria-labelledby="addEventModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="addEventModalLabel">Add Event</h4>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <label for="addEventTitle" class="control-label">Event Title:</label>
                                    <input type="text" class="form-control" id="addEventTitle">
                                </div>
                                <div class="form-group">
                                    <label for="addEventStart" class="control-label">Start:</label>
                                    <input type="text" class="form-control" id="addEventStart" data-format="MM-DD-YYYY h:mm a" data-template="MMM D YYYY hh:mm a" name="datetime">
                                </div>
                                <div class="form-group">
                                    <label for="addEventEnd" class="control-label">End:</label>
                                    <input type="text" class="form-control" id="addEventEnd" data-format="MM-DD-YYYY h:mm a" data-template="MMM D YYYY hh:mm a" name="datetime">
                                </div>
                                <div class="form-group">
                                    <label for="addEventLocation" class="control-label">Location:</label>
                                    <input type="text" class="form-control" id="addEventLocation">
                                </div>
                                <div class="form-group">
                                    <label for="addEventDesc" class="control-label">Description:</label>
                                    <textarea type="text" class="form-control" id="addEventDesc"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary" id="addEventSubmit">Add</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal fade" id="eventDetailsModal" tabindex="-1" role="dialog" aria-labelledby="eventDetailsModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="eventDetailsModalLabel">Event Details</h4>
                        </div>
                        <div class="modal-body">
                            <div class="container">
                                <div class="row">
                                    <strong>Event Title: </strong><p id="eventDetailsTitle"></p>
                                </div>
                                <div class="row">
                                    <strong>Start: </strong><p id="eventDetailsStart"></p>
                                </div>
                                <div class="row">
                                    <strong>End: </strong><p id="eventDetailsEnd"></p>
                                </div>
                                <div class="row">
                                    <strong>Location: </strong><p id="eventDetailsLocation"></p>
                                </div>
                                <div class="row">
                                    <strong>Description: </strong><p id="eventDetailsDesc"></p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-danger" id="eventDetailsSubmit">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        
            <div id="calendar">
            </div>
        </div>
    </main>

</body>
</html>
